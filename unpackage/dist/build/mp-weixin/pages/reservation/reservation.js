(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/reservation/reservation"],{5110:function(t,e,n){"use strict";var i=n("a0fe"),o=n.n(i);o.a},"591e":function(t,e,n){"use strict";(function(t){var i=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("7eb4")),a=i(n("ee10")),r=i(n("7ca3")),s=n("a0ce"),u=n("e68b"),c=n("8f59"),m=n("9def");function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var l={data:function(){return{labelPosition:"right",imgData:null,formData:{name:"",phone:"",address:"",startTime:"",endTime:"",latitude:"",longitude:"",notes:""},startTime:"",endTime:"",minStarTime:"",minEndTime:"",maxEndTime:"",formatter:function(t,e){return"year"===t?"".concat(e,"年"):"month"===t?"".concat(e,"月"):"day"===t?"".concat(e,"日"):"hour"===t?"".concat(e,"时"):"minute"===t?"".concat(e,"分"):e}}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({totalTime:function(){if(this.formData.startTime&&this.formData.endTime){var t=new Date(this.formData.startTime.replace(/-/g,"/")),e=new Date(this.formData.endTime.replace(/-/g,"/")),n=e-t,i=Math.floor(n/36e5),o=Math.floor(n%36e5/6e4);return"".concat(i<10?"0"+i:i,"时").concat(o<10?"0"+o:o,"分")}return""}},(0,c.mapGetters)(["userinfo"])),onLoad:function(){},methods:{startConfirm:function(t){this.formData.startTime=(0,u.timeFormat)(t.value,"yyyy-mm-dd hh:MM"),this.formData.endTime="",this.endTime=""},endConfirm:function(t){this.formData.endTime=(0,u.timeFormat)(t.value,"yyyy-mm-dd hh:MM")},showSelectDate:function(e){if("start"===e&&(this.minStarTime=+new Date,this.$refs.startTime.open()),"end"===e){if(!this.formData.startTime)return void t.showToast({title:"请选择开始时间",icon:"none"});this.$refs.endTime.open()}},submit:function(){var e=this;if(this.formData.name)if(this.formData.phone){if(/^1[3-9]\d{9}$/.test(this.formData.phone))if(this.formData.address)if(this.formData.startTime)if(this.formData.endTime){if(this.imgData){var n={studentId:this.userinfo.id,startTime:this.formData.startTime+":00",endTime:this.formData.endTime+":00",longitude:this.formData.longitude,latitude:this.formData.latitude,address:this.formData.address,stuName:this.formData.name,telephone:this.formData.phone,imageId:this.imgData.imageId,notes:this.formData.notes};return t.showLoading({title:"提交中...",mask:!0}),(0,m.post)("/lessonManagement/classReservation",n).then((function(n){t.showToast({title:"提交成功",duration:1e3,mask:!0}),setTimeout((function(){t.redirectTo({url:"/pages/index/index"})}),1e3),e.imgData=null,e.formData.name="",e.formData.phone="",e.formData.address="",e.formData.startTime="",e.formData.endTime="",e.formData.latitude="",e.formData.longitude="",e.formData.notes="",e.startTime="",e.endTime="",e.minStarTime="",e.minEndTime="",e.maxEndTime=""})).catch((function(e){t.showToast({title:"提交失败",icon:"none",duration:2e3}),console.log(e)}))}t.showToast({title:"请上传驾驶证",icon:"none"})}else t.showToast({title:"请选择接预约结束时间",icon:"none"});else t.showToast({title:"请选择接预约开始时间",icon:"none"});else t.showToast({title:"请选择接送地址",icon:"none"});else t.showToast({title:"手机号格式错误",icon:"none"})}else t.showToast({title:"请输入手机号",icon:"none"});else t.showToast({title:"请输入姓名",icon:"none"})},handleStartChange:function(){this.formData.endTime=""},getLocationAndSelectAddress:function(){var e=this;return(0,a.default)(o.default.mark((function n(){var i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=e,t.getLocation({success:function(e){t.chooseLocation({latitude:e.latitude,longitude:e.longitude,success:function(t){i.formData.address=t.name,i.formData.latitude=t.latitude,i.formData.longitude=t.longitude},fail:function(t){console.log(t)}})},fail:function(e){t.getSetting({success:function(e){e.authSetting["scope.userLocation"]||t.showModal({title:"需要定位权限",content:"我们需要您的位置权限来提供服务",success:function(e){e.confirm&&t.openSetting({success:function(e){e.authSetting["scope.userLocation"]?i.getLocationAndSelectAddress():t.showToast({title:"需要您授权位置权限",icon:"none"})}})}})}})}});case 2:case"end":return n.stop()}}),n)})))()},selectAddress:function(){this.getLocationAndSelectAddress()},handleRemove:function(){var e=this;t.showModal({title:"是否移除当前图片",success:function(t){t.confirm&&(e.imgData=null)}})},handlePreview:function(){t.previewImage({urls:[this.imgData.url]})},uploadImg:function(){var e=this;t.chooseImage({count:1,success:function(n){t.showLoading({title:"上传中...",mask:!0}),t.uploadFile({url:s.baseURL+"/weCom/uploadFile",filePath:n.tempFilePaths[0],name:"file",formData:{stuId:e.userinfo.id},success:function(i){var o=JSON.parse(i.data);e.imgData={},e.imgData.imageId=o.data,e.imgData.url=n.tempFilePaths[0],e.imgData.name="大小",e.imgData.size=Math.floor(n.tempFiles[0].size/1024)+"KB",t.showToast({title:"上传成功",icon:"none"})},fail:function(n){t.showToast({title:"上传失败",icon:"none"}),e.imgData=null,console.log(n)}})}})}}};e.default=l}).call(this,n("df3c")["default"])},"644a":function(t,e,n){"use strict";n.r(e);var i=n("591e"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},9522:function(t,e,n){"use strict";n.r(e);var i=n("b94b"),o=n("644a");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("5110");var r=n("828b"),s=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"02f59372",null,!1,i["a"],void 0);e["default"]=s.exports},a0fe:function(t,e,n){},b94b:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,"a5c0"))},uniFormsItem:function(){return n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item").then(n.bind(null,"a6de"))},uniEasyinput:function(){return n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(n.bind(null,"fc81"))},uvIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uv-icon/components/uv-icon/uv-icon")]).then(n.bind(null,"145a"))},uvDatetimePicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uv-datetime-picker/components/uv-datetime-picker/uv-datetime-picker")]).then(n.bind(null,"6e89"))}},o=function(){var t=this.$createElement;this._self._c},a=[]},cb30:function(t,e,n){"use strict";(function(t,e){var i=n("47a9");n("5d25");i(n("3240"));var o=i(n("9522"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])}},[["cb30","common/runtime","common/vendor"]]]);